<?xml version="1.0" encoding="UTF-8"?>

<Module>
    <ModulePrefs title="SKIP新着ガジェット">
        <Require feature="dynamic-height"/>
        <Require feature="tabs"/>
    </ModulePrefs>

    <Content type="html" view="home,canvas">
<![CDATA[
<script type="text/javascript">

var tabs = new _IG_Tabs(__MODULE_ID__);
var prefs = new gadgets.Prefs();

function init() {
    var tabs = new _IG_Tabs(__MODULE_ID__, "新着グループ");
    tabs.addDynamicTab("新着グループ", callbackGenerator("https://test.skipaas.jp/gadgets/skip_recent_groups"));
    tabs.addDynamicTab("新着ユーザ",  callbackGenerator("https://test.skipaas.jp/gadgets/skip_recent_users"));
};

function callbackGenerator(target_url) {
    return function(tabId) {
        callbackTab(tabId, target_url);
    }
};

function callbackTab(tabId, target_url) {
    gadgets.io.makeRequest(target_url, response, { AUTHORIZATION: gadgets.io.AuthorizationType.IS_POST_PORTAL_UID});
};

function response(obj){
    _gel(tabId).innerHTML = obj.text;
    gadgets.window.adjustHeight();

    var links = document.getElementsByTagName("a");
    for(var i=0;i<links.length;i++){
        links[i].onclick = function(){
            try{
                _IS_OpenPortalIframe(this.href);
            }catch(e){
                console.info(e);
            }
            return false;
        }
    }
};

gadgets.util.registerOnLoadHandler(init);

</script>

<style type="text/css">
<!--
-->
</style>
]]>
    </Content>
</Module>
